version: "3"
interval: 500ms
tasks:
  default:
    cmds:
      - task: build-test
  env-reload:
    cmds:
      - direnv reload
      - nix-direnv-reload
    aliases:
      - env
  run:
    deps:
      - build
    cmds:
      - build/main
    method: none
  debug:
    deps:
      - build-debug
    cmds:
      - gdb debug/main --tui
    aliases:
      - d
    method: none
  debug-dap:
    deps:
      - build-debug
    cmds:
      - gdb debug/main -i dap
    method: none
  mkdir-build:
    precondition: "[ ! -e build ]"
    sources:
      - "build/"
    cmds:
      - mkdir build
    internal: true
  build:
    deps:
      - mkdir-build
    sources:
      - "src/**/*.odin"
    cmds:
      - odin build src/main -out:build/main
    aliases:
      - b
    generates:
      - build/main
  mkdir-test:
    precondition: "[ ! -e test ]"
    sources:
      - "test/"
    cmds:
      - mkdir test
    internal: true
  build-test:
    deps:
      - mkdir-test
    sources:
      - "src/**/*.odin"
    cmds:
      - odin test src/main -out:test/main
    aliases:
      - test
      - t
    generates:
      - test/main
  mkdir-debug:
    precondition: "[ ! -e debug ]"
    sources:
      - "debug/"
    cmds:
      - mkdir debug
    internal: true
  build-debug:
    deps:
      - mkdir-debug
    sources:
      - "src/**/*.odin"
    cmds:
      - odin build src/main -out:debug/main -o:none -debug
    aliases:
      - bd
    generates:
      - debug/main
  watch:
    watch: true
    sources:
      - "src/**/*.odin"
    cmds:
      - task: test
  watch-run:
    watch: true
    sources:
      - "src/**/*.odin"
    cmds:
      - task: run
